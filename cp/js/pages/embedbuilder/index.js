(()=>{const n=document.getElementById("custom-username"),a=document.getElementById("custom-username-wordcount"),o=document.getElementById("custom-avatarurl"),r=document.getElementById("usewebhookinfo"),t=document.getElementById("savewebhookurl"),i=document.getElementById("sendwebhookbtn"),s=document.querySelector("#sendmessageBtn"),l=document.querySelector("#webhookURL"),d=document.getElementById("sendtochannel"),c="https://discord.com/api/",u=c+"webhooks";c;try{var e=localStorage.getItem("ebWebhookURL");e&&w(e)&&(l.value=localStorage.getItem("ebWebhookURL"),$.ajax({url:e,method:"GET",success:function(e){window.ContentHandler.ToggleValidation(l,!0),f(!0),p=e.name,b=e.avatar,t.checked=!0},error:function(e){window.ContentHandler.ToggleValidation(l,!1),f(!1)}}))}catch(e){console.log(e)}document.getElementById("viewport").addEventListener("load",function(){var e=document.querySelector("#placeholder"),t=document.getElementById("viewport");e.remove(),t.style.visibility="visible",s.disabled=!1,s.innerHTML='<i class="ti ti-send-2 d-block d-lg-none d-md-none"></i> <span class="d-none d-lg-block d-md-block">Send to channel</span>',(e=localStorage.getItem("ebUsername"))&&(y("updateUsername",{username:e,save:!1}),n.value=e,a.innerText=e.length+"/80",80<a.innerText||a.innerText<1?(window.ContentHandler.ToggleValidation(n,!1),a.classList.add("bg-danger"),a.classList.remove("bg-success")):(window.ContentHandler.ToggleValidation(n,!0),a.classList.add("bg-success"),a.classList.remove("bg-danger"))),(t=localStorage.getItem("ebAvatarurl"))&&(y("updateAvatar",{avatar:t,save:!1}),o.value=localStorage.getItem("ebAvatarurl"),o.value.length<1||0==h(o.value)?window.ContentHandler.ToggleValidation(o,!1):window.ContentHandler.ToggleValidation(o,!0))});const g=document.querySelector("#displayfullscreeniframe");g.addEventListener("click",function(){var e=document.querySelector("#frameholder");e.classList.contains("fullscreen-div")?(e.classList.remove("fullscreen-div"),g.innerHTML='<i class="ti ti-arrows-maximize"></i>'):(e.classList.add("fullscreen-div"),g.innerHTML='<i class="ti ti-arrows-minimize"></i>',document.getElementById("viewport").scrollIntoView({behavior:"smooth",block:"center"}))}),document.querySelector("#sendmessageBtn").addEventListener("click",function(){frameholder.classList.contains("fullscreen-div")&&(frameholder.classList.remove("fullscreen-div"),g.innerHTML='<i class="ti ti-arrows-maximize"></i>')});const m=document.querySelector("#guildselect"),v=document.querySelector("#channelselect");function h(e){return null!=e.match(/\.(jpeg|jpg|gif|png|webp)(\?.*)?$/)}function w(e){return!!e.startsWith(c)}m&&(window.ContentHandler.ToggleMultiSelect("#channelselect",{placeholder:"Select a channel"}),m.addEventListener("change",e=>{e=e.target.value;window.DiscordAPIHandler.getChannels(e,{channelType:"GuildText"}).then(e=>{v.innerHTML="",e.data.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent="# "+e.name,v.appendChild(t)}),window.ContentHandler.ToggleMultiSelect("#channelselect",{placeholder:"Select a channel"}),d.disabled=!1}).catch(e=>{d.disabled=!0,window.NotificationHandler.show({title:"Error",content:e.message,type:"error"})})}));let p,b;function f(e){1==e?(i.disabled=!1,r.disabled=!1,t.disabled=!1):0==e&&(i.disabled=!0,r.disabled=!0,t.disabled=!0)}function y(e,t){document.getElementById("viewport").contentWindow.postMessage({event_id:e||"buildRequest",data:t||null},"*")}l.addEventListener("input",e=>{e=e.target.value;if(!w(e))return f(!1),window.ContentHandler.ToggleValidation(l,!1);$.ajax({url:e,method:"GET",success:function(e){f(!0),window.ContentHandler.ToggleValidation(l,!0),p=e.name,b=`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.webp?size=256`},error:function(e){f(!1),window.ContentHandler.ToggleValidation(l,!1)}})}),n.addEventListener("input",function(){var e=this.value.length;a.innerText=e+"/80",80<e||e<1?(window.ContentHandler.ToggleValidation(n,!1),a.classList.add("bg-danger"),a.classList.remove("bg-success")):(y("updateUsername",{username:this.value,save:!0}),window.ContentHandler.ToggleValidation(n,!0),a.classList.add("bg-success"),a.classList.remove("bg-danger"))}),o.addEventListener("input",function(){if(this.value.length<1||0==h(this.value))return window.ContentHandler.ToggleValidation(o,!1);y("updateAvatar",{avatar:this.value,save:!0}),window.ContentHandler.ToggleValidation(o,!0)}),r.addEventListener("click",function(){this.checked?(p&&y("updateUsername",{username:p,save:!1}),y("updateAvatar",{avatar:b||"https://cdn.discordapp.com/embed/avatars/0.png",save:!1})):(y("updateUsername",{username:localStorage.ebUsername,save:!1}),y("updateAvatar",{avatar:localStorage.ebAvatarurl,save:!1}))}),t.addEventListener("click",function(){this.checked?localStorage.setItem("ebWebhookURL",l.value):localStorage.removeItem("ebWebhookURL")}),i.addEventListener("click",async function(){if(w(l.value)){let e=l.value;e.startsWith(u)&&((e=e.replace(u,"https://discord.com/api/v10/webhooks")).includes("?")?(t=e.split("?"),e=t[0]+"?wait=true"):e+="?wait=true");var t={Accept:"application/json","Accept-Language":"en"},n=localStorage.getItem("embedbuilderjson");n&&(n=JSON.parse(n),1==r.checked?(n.username=p,n.avatar_url=b):(n.username=localStorage.getItem("ebUsername"),n.avatar_url=localStorage.getItem("ebAvatarurl")),"string"==typeof(n=JSON.stringify(n))&&(t["Content-Type"]="application/json"),$.ajax({url:e,method:"POST",data:n,headers:t,success:async function(e,t,n){"0"==n.getResponseHeader("X-RateLimit-Remaining")&&(n=1e3*Number(n.getResponseHeader("X-RateLimit-Reset-After")??2),window.NotificationHandler.show({title:"Error",content:`You are being rate limited. Please try again in ${n/1e3} seconds.`,type:"error"})),window.NotificationHandler.show({title:"Webhook success",content:"Your webhook was sent successfully",type:"success"})},error:function(e){window.NotificationHandler.show({title:"Error",content:e.responseJSON.message,type:"error"})}}))}}),d&&d.addEventListener("click",async function(){var e=$("#channelselect").find(":selected");if(e.length<1)return window.NotificationHandler.show({title:"Error",content:"Please select a channel",type:"error"});for(var t=[],n=0;n<e.length;n++)t.push(e[n].value);$.ajax({url:"/embedbuilder/sendtochannel",method:"POST",contentType:"application/json",data:JSON.stringify({guildId:m.value,channelId:t,embedjson:localStorage.getItem("embedbuilderjson")}),success:function(e,t,n){if("0"==n.getResponseHeader("sendtochannel"))return n=1e3*Number(n.getResponseHeader("X-RateLimit-Reset-After")??2),window.NotificationHandler.show({title:"Webhook error",body:`You are being rate limited. Please try again in ${n/1e3} seconds.`,type:"error"});for(var a=e.data,o=0;o<a.length;o++)"Success"!=a[o].status&&window.NotificationHandler.show({title:"Error sending embed to: "+a[o].channelName,content:a[o].status,type:"error"});window.NotificationHandler.show({title:"Webhook success",content:"Your webhook was sent successfully",type:"success"})},error:function(e){window.NotificationHandler.show({title:"Error",content:e.responseJSON.message,type:"error"})}})})})();